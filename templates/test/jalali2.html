<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <title>تقویم شمسی</title>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Persian Date Picker -->
    <script src="https://unpkg.com/persian-date@1.1.0/dist/persian-date.min.js"></script>
    <script src="https://unpkg.com/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @font-face {
            font-family: 'IRANSans';
            src: url('path-to-your-font/IRANSans.ttf');
        }

        * {
            box-sizing: border-box;
            font-family: 'IRANSans', sans-serif;
        }

        .date-inputs {
            display: flex;
            gap: 15px;
            padding: 20px;
            justify-content: center;
        }

        .input-container {
            position: relative;
            width: 200px;
        }

        .date-input {
            width: 100%;
            padding: 10px 35px 10px 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .date-input:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(74, 175, 80, 0.1);
            outline: none;
        }

        .calendar-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            cursor: pointer;
            transition: color 0.3s ease;
            z-index: 1;
        }

        .calendar-icon:hover {
            color: #4CAF50;
        }

        /* تنظیمات ظاهری تقویم */
        .persian-datepicker {
            font-family: 'IRANSans' !important;
        }

        .datepicker-plot-area {
            font-family: 'IRANSans' !important;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15) !important;
        }

        .datepicker-plot-area .datepicker-day-view .table-days td span {
            border-radius: 50%;
            width: 40px;
            height: 40px;
            line-height: 40px;
        }

        .datepicker-plot-area .datepicker-day-view .table-days td span:hover {
            background-color: #e8f5e9 !important;
            color: #4CAF50 !important;
        }

        .datepicker-plot-area .datepicker-day-view .table-days td.selected span {
            background-color: #4CAF50 !important;
            color: white !important;
        }

        .datepicker-plot-area .datepicker-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }
        /* استایل‌های قبلی حفظ شود و این‌ها اضافه شود */
.convert-icon {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
    cursor: pointer;
    transition: all 0.3s ease;
}

.convert-icon:hover {
    color: #4CAF50;
    transform: translateY(-50%) rotate(180deg);
}

#gregorian-input {
    padding-right: 35px;
}
    </style>
</head>
<body>
    <div class="date-inputs">
        <div class="input-container">
            <input type="text" class="date-input" id="jalali-date" readonly placeholder="تاریخ شمسی">
            <i class="fas fa-calendar-alt calendar-icon"></i>
        </div>
        <div class="input-container">
            <input type="text" class="date-input" id="gregorian-date" readonly placeholder="تاریخ میلادی">
        </div>
    </div>
    <div class="date-inputs">
        <div class="input-container">
            <input type="text" class="date-input" id="gregorian-input" placeholder="تاریخ میلادی (YYYY/MM/DD)">
            <i class="fas fa-exchange-alt convert-icon"></i>
        </div>
        <div class="input-container">
            <input type="text" class="date-input" id="jalali-result" readonly placeholder="تاریخ شمسی">
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // تنظیم تاریخ پیش‌فرض
            const today = new persianDate();
            
            // تنظیمات تقویم
            $('#jalali-date').persianDatepicker({
                initialValue: true,
                format: 'YYYY/MM/DD',
                autoClose: true,
                calendar: {
                    persian: {
                        locale: 'fa'
                    }
                },
                dayPicker: {
                    onSelect: function(unix) {
                        // تبدیل به تاریخ میلادی
                        const gregorianDate = new Date(unix);
                        $('#gregorian-date').val(gregorianDate.toLocaleDateString('en-US'));
                    }
                },
                toolbox: {
                    enabled: true,
                    calendarSwitch: {
                        enabled: false
                    }
                },
                navigator: {
                    scroll: {
                        enabled: false
                    }
                },
                onSelect: function(unix) {
                    // بستن تقویم بعد از انتخاب تاریخ
                    $(this).persianDatepicker('hide');
                }
            });

            // باز کردن تقویم با کلیک روی آیکون
            $('.calendar-icon').click(function() {
                $('#jalali-date').persianDatepicker('show');
            });
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.datepicker-plot-area').length && 
                    !$(e.target).is('#jalali-date') && 
                    !$(e.target).is('.calendar-icon')) {
                    $('#jalali-date').persianDatepicker('hide');
                }
            });
            // تنظیم تاریخ امروز به صورت پیش‌فرض
            $('#jalali-date').persianDatepicker('setDate', today);
            const gregorianToday = new Date();
            $('#gregorian-date').val(gregorianToday.toLocaleDateString('en-US'));
        });
    </script>
    <script>
        $(document).ready(function() {
            // تابع تبدیل اعداد انگلیسی به فارسی
            function toPersianNum(num) {
                const persianNumbers = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
                return num.toString().replace(/[0-9]/g, x => persianNumbers[x]);
            }
        
            // تابع اعتبارسنجی فرمت تاریخ
            function isValidDate(dateStr) {
                const regex = /^\d{4}\/\d{2}\/\d{2}$/;
                if (!regex.test(dateStr)) return false;
                
                const [year, month, day] = dateStr.split('/').map(Number);
                const date = new Date(year, month - 1, day);
                
                return date.getFullYear() === year &&
                       date.getMonth() === month - 1 &&
                       date.getDate() === day;
            }
        
            // تبدیل تاریخ با فشردن دکمه
            $('.convert-icon').click(function() {
                const gregorianDate = $('#gregorian-input').val();
                
                if (!isValidDate(gregorianDate)) {
                    alert('لطفا تاریخ را به فرمت صحیح وارد کنید (YYYY/MM/DD)');
                    return;
                }
        
                const [year, month, day] = gregorianDate.split('/');
                const date = new Date(year, month - 1, day);
                const jalaliDate = new persianDate(date);
        
                const jalaliStr = `${jalaliDate.year()}/${toPersianNum(jalaliDate.month())}/${toPersianNum(jalaliDate.date())}`;
                $('#jalali-result').val(jalaliStr);
            });
        
            // تبدیل خودکار هنگام تایپ (با تأخیر)
            let timeout;
            $('#gregorian-input').on('input', function() {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    const gregorianDate = $(this).val();
                    
                    if (isValidDate(gregorianDate)) {
                        const [year, month, day] = gregorianDate.split('/');
                        const date = new Date(year, month - 1, day);
                        const jalaliDate = new persianDate(date);
        
                        const jalaliStr = `${jalaliDate.year()}/${toPersianNum(jalaliDate.month())}/${toPersianNum(jalaliDate.date())}`;
                        $('#jalali-result').val(jalaliStr);
                    }
                }, 500);
            });
        
            // اضافه کردن اسلش به صورت خودکار
            $('#gregorian-input').on('keyup', function(e) {
                if (e.key !== 'Backspace' && e.key !== 'Delete') {
                    const value = $(this).val().replace(/\//g, '');
                    if (value.length >= 4) {
                        const formatted = value.substring(0, 4) + '/' + 
                                        value.substring(4, 6) + 
                                        (value.length > 6 ? '/' + value.substring(6, 8) : '');
                        $(this).val(formatted);
                    }
                }
            });
        });
        </script>
</body>
</html>
