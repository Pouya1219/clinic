<!-- templates/Patient/partials/_installment_details_partial.html -->
{% load humanize %}

<div class="installment-details-header">
    <h4>طرح اقساط برای: {{ plan.treatment.treatment_detail.description }}</h4>
    <div class="installment-summary">
        <span>مبلغ کل: <strong>{{ plan.total_amount|intcomma }} ریال</strong></span>
        <span>پیش پرداخت: <strong>{{ plan.down_payment|intcomma }} ریال</strong></span>
    </div>
</div>

<table class="payment_modern-table mt-3">
    <thead>
        <tr>
            <th>#</th>
            <th>مبلغ قسط</th>
            <th>تاریخ سررسید</th>
            <th>وضعیت</th>
            <th class="text-center">عملیات</th>
        </tr>
    </thead>
    <tbody>
        {% for inst in plan.installments.all %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ inst.amount|intcomma }} ریال</td>
            <td>{{ inst.due_date|date:"Y/m/d" }}</td>
            <td>
                {% if inst.is_paid %}
                    <span class="status-badge success">پرداخت شده در {{ inst.payment_date|date:"Y/m/d" }}</span>
                {% else %}
                    <span class="status-badge warning">پرداخت نشده</span>
                {% endif %}
            </td>
            <td class="text-center">
                {% if not inst.is_paid %}
                    <button class="btn btn-sm btn-primary" onclick="PaymentManager.payInstallment('{{ inst.id }}', '{{ inst.amount }}')">پرداخت قسط</button>
                {% else %}
                    <button class="btn btn-sm btn-secondary" disabled title="این قسط پرداخت شده است"><i class="fas fa-check"></i></button>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="payment_empty-row">هیچ قسطی برای این طرح یافت نشد.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
