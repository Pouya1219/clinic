{% load date_tags %}
{% load static %}

<div class="edit-user-tabs__profile-img">
    <!-- فرم اول برای آپلود عکس و امضا -->
    <form method="POST" action="{% url 'edit_user_images' profile.id %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-section">
    <h3>تصاویر</h3>
        <div class="form-row">
            <div class="form-group col-md-6">
            <label>تصویر پروفایل</label>
                <div class="custom-file">
                <input type="file" name="avatar" class="custom-file-input" id="avatar" onchange="previewImage(this, 'avatar-preview')">
                <label class="custom-file-label" for="avatar">انتخاب تصویر</label>
                </div>
            <div class="image-preview">
                {% if profile.personnel_card.avatar %}
                    <img src="{{ profile.personnel_card.avatar.url }}" alt="Avatar" id="avatar-preview" class="preview-image">
                {% else %}
                    <img src="" alt="" id="avatar-preview" class="preview-image" style="display: none;">
                {% endif %}
        </div>
</div>
        <div class="form-group col-md-6">
            <label>امضا</label>
            <div class="custom-file">
                <input type="file" name="signature" class="custom-file-input" id="signature" onchange="previewImage(this, 'signature-preview')">
                <label class="custom-file-label" for="signature">انتخاب تصویر امضا</label>
            </div>
            <div class="image-preview">
                {% if profile.personnel_card.signature %}
                    <img src="{{ profile.personnel_card.signature.url }}" alt="Signature" id="signature-preview" class="preview-image">
                {% else %}
                    <img src="" alt="" id="signature-preview" class="preview-image" style="display: none;">
                {% endif %}
            </div>
        </div>
            
        </div>
        <div class="form-buttons">
                <button type="submit" class="btn btn-primary">ذخیره تغییرات</button>
                <a href="{% url 'user_list' %}" class="btn btn-secondary">انصراف</a>
            </div>
    </form>
</div>
    <!-- فرم دوم برای صدور کارت - جدا از فرم اصلی -->
    <div class="form-section">
        <h3>کارت پرسنلی</h3>
        {% if profile.personnel_card %}
            <div class="personnel-card">
                <div class="card-info">
                    <p>شماره کارت: {{ profile.personnel_card.card_number }}</p>
                    <p> نام: {{ profile.first_name }}</p>
                    <p> نام خانوادگی: {{ profile.last_name }}</p>
                    <p>تاریخ صدور: {{ profile.personnel_card.issue_date|to_jalali }}</p>
                    <p>تاریخ انقضا: {{ profile.personnel_card.expiry_date|to_jalali }}</p>
                    <p>وضعیت: {% if profile.personnel_card.is_active %}فعال{% else %}غیرفعال{% endif %}</p>
                    </div>
                
                {% if profile.personnel_card.card_image %}
                <div class="card-preview">
                    <img src="{{ profile.personnel_card.card_image.url }}" alt="Personnel Card" class="card-image">
                </div>
                {% endif %}
                       
                <div class="card-actions">
    <button type="button" class="btn btn-info print-card-btn">
        <i class="fas fa-print"></i> چاپ کارت
    </button>
                <form method="POST" action="{% url 'manage_personnel_card' profile.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="regenerate">
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-sync"></i> تولید مجدد کارت
                    </button>
                </form>
            </div>
        {% else %}
            <div class="no-card">
                <form method="POST" action="{% url 'manage_personnel_card' profile.id %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="generate">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-id-card"></i> صدور کارت پرسنلی
                    </button>
                </form>
            </div>
        {% endif %}
    </div>
</div>
</div>
