<div class="edit-user-tabs__user-info">
    <!-- محتوای تب اطلاعات کاربر -->
      {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
<div class="edit-user-wrapper">
    <form method="POST" action="{% url 'edit_user' profile.id %}" enctype="multipart/form-data">
        {% csrf_token %}
        
        <h1>ویرایش کاربر</h1>
        <hr>
        <div class="percentage-card">
            <div class="percentage-grid">
                <div class="percentage-item">
                    <label>نام کاربری</label>
                    <input type="text" value="{{ profile.user.username }}" class="form-input" readonly>
                </div>
                <div class="percentage-item">
                    <label>رمز عبور </label>
                    <input type="text" name="password" class="form-input" placeholder="برای تغییر رمز عبور وارد کنید">
                </div>
                
                <div class="percentage-item date-inputs">
                    <label>تاریخ اعتبار از</label>
                    <div class="date-input-container input-wrapper input-container">
                        <i class="fas fa-calendar-alt calendar-icon icon-left"></i>
                        <input type="text" name="start_date" class="date-input form-input jalali input-field" value="{{ start_date_shamsi }}" data-id="6" readonly>
                    </div>
                </div>

                <div class="percentage-item date-inputs">
                    <label>تاریخ اعتبار تا</label>
                    <div class="date-input-container input-wrapper input-container">
                        <i class="fas fa-calendar-alt calendar-icon icon-left"></i>
                        <input type="text" name="end_date" class="date-input form-input jalali input-field" value="{{ end_date_shamsi }}" data-id="7" readonly>
                    </div>
                </div>

                <div class="percentage-item" style="background-color:white; color:black;">
                    <label>تعداد کاربر: {{ total_users }}</label>
                </div>

                {% if remaining_users <= 0 %}
                <div class="alert alert-danger">
                    تعداد کاربران مجاز به پایان رسیده است. لطفا لایسنس خود را ارتقا دهید.
                </div>
                {% else %}
                <div class="alert alert-info">
                    تعداد کاربران باقیمانده: {{ remaining_users }} از {{ license.max_users }}
                </div>
                {% endif %}

                <div class="percentage-item" style="background-color:white; color:black;">
                    <label>کاربر فعال: {{ active_users }}</label>
                </div>

                <div class="percentage-item" style="background-color:white; color:black;">
                    <label class="checkbox-container">
                        <input type="checkbox" name="is_active" {% if profile.is_activate %}checked{% endif %}>
                        <span class="checkmark"></span>
                        کاربر فعال
                    </label>
                </div>
            </div>
        </div>

        <h1>اطلاعات کاربر</h1>
        <hr>
        
        <div class="form-section percentage-card">
            <div class="form-grid">
                <div class="form-group">
                    <label>شماره پرسنلی</label>
                    <input type="number" name="personal_number" class="form-input" value="{{ profile.personal_number }}" required>
                </div>
                <div class="form-group">
                    <label>نام</label>
                    <input type="text" name="first_name" class="form-input" value="{{ profile.first_name }}" required>
                </div>
                <div class="form-group">
                    <label>نام خانوادگی</label>
                    <input type="text" name="last_name" class="form-input" value="{{ profile.last_name }}" required>
                </div>
                <div class="form-group">
                    <label>کد ملی</label>
                    <input type="number" name="national_code" class="form-input" value="{{ profile.national_code }}" pattern="[0-9]{10}" maxlength="10">
                </div>

                <div class="form-group">
                    <label>موبایل</label>
                    <input type="tel" name="mobile" class="form-input" value="{{ profile.mobile }}">
                </div>
                <div class="form-group">
                    <label>تلفن ثابت</label>
                    <input type="tel" name="phone" class="form-input" value="{{ profile.phone }}">
                </div>
                <div class="form-group">
                    <label>کد پستی</label>
                    <input type="text" name="postal_code" class="form-input" value="{{ profile.postal_code }}">
                </div>

                <div class="form-group">
                    <label>کد نظام پزشکی</label>
                    <input type="number" name="medical_code" class="form-input" value="{{ profile.medical_code }}">
                </div>
                <div class="form-group">
                    <label>سمت</label>
                    <select name="role" class="form-input" required>
                        <option value="">انتخاب کنید</option>
                        {% for role in roles %}
                            <option value="{{ role.id }}" {% if profile.role_id == role.id %}selected{% endif %}>
                                {{ role.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>تخصص پزشک</label>
                    <select name="specialty" class="form-input" id="specialtySelect">
                        <option value="">انتخاب کنید</option>
                        {% for sp in specialties %}
                            <option value="{{ sp.id }}" {% if profile.specialty_id == sp.id %}selected{% endif %}>
                                {{ sp.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>مدرک تحصیلی</label>
                    <select name="education" class="form-input">
                        <option value="">انتخاب کنید</option>
                        {% for ed in educations %}
                            <option value="{{ ed.id }}" {% if profile.education_id == ed.id %}selected{% endif %}>
                                {{ ed.degree }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label>محل تولد</label>
                    <input type="text" name="birthplace" class="form-input" value="{{ profile.birthplace }}">
                </div>

                <div class="form-group">
                    <label>تاریخ تولد</label>
                    <div class="date-input-container input-wrapper input-container">
                        <i class="fas fa-calendar-alt calendar-icon icon-left"></i>
                        <input type="text" name="birth_date" class="date-input form-input jalali input-field" value="{{ birth_date_shamsi }}" data-id="110" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label>جنسیت</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="sex" value="true" class="radio-input" {% if profile.sex %}checked{% endif %}>
                            <span class="radio-custom"></span>
                            <span class="radio-text">مرد</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="sex" value="false" class="radio-input" {% if not profile.sex %}checked{% endif %}>
                            <span class="radio-custom"></span>
                            <span class="radio-text">زن</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>وضعیت تاهل</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="is_married" value="false" class="radio-input" {% if not profile.is_married %}checked{% endif %}>
                            <span class="radio-custom"></span>
                            <span class="radio-text">مجرد</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="is_married" value="true" class="radio-input" {% if profile.is_married %}checked{% endif %}>
                            <span class="radio-custom"></span>
                            <span class="radio-text">متاهل</span>
                        </label>
                    </div>
                </div>

                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>آدرس</label>
                    <textarea name="address" class="form-textarea" rows="4">{{ profile.address }}</textarea>
                </div>
            </div>
        </div>

        <h1>درصد ها</h1>
        <hr>
        <div class="percentage-card">
            <div class="percentage-grid">
                <div class="percentage-item">
                    <h3>درصد کارکرد پزشک</h3>
                    <input type="number" name="work_percentage" class="percentage-input" step="0.01" value="{{ profile.work_percentage }}">
                </div>
                <div class="percentage-item">
                    <h3>درصد هزینه لابراتوار</h3>
                    <input type="number" name="lab_expense_percentage" class="percentage-input" step="0.01" value="{{ profile.lab_expense_percentage }}">
                </div>
                <div class="percentage-item">
                    <h3>درصد هزینه مواد</h3>
                    <input type="number" name="material_expense_percentage" class="percentage-input" step="0.01" value="{{ profile.material_expense_percentage }}">
                </div>
                <div class="percentage-item">
                    <h3>درصد مالیات</h3>
                    <input type="number" name="tax_percentage" class="percentage-input" step="0.01" value="{{ profile.tax_percentage }}">
                </div>
            </div>
        </div>

        <div class="center btn-group">
    <button type="submit" class="save-button">
        <i class="fas fa-save"></i>
        ذخیره تغییرات
    </button>
    <a href="{% url 'user_list' %}" class="save-button">
        <i class="fas fa-times"></i>
        انصراف
    </a>
</div>
    </form>
</div>
</div>